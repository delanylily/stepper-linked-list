<frame>
  <div body class="container">
    <div class="chat-list mat-elevation-z5">
      <div class="search-input">
      </div>
      <select (change)="onUserSelected($event.target.value)" class="form-select">
        <option selected>Select user</option>
        <option *ngFor="let user of filteredUsers" [value]="user.uid">{{user.displayName}}
        </option>
      </select>
      <mat-selection-list [multiple]="false" [formControl]="chatListControl">
        <mat-divider></mat-divider>
        <mat-list-option class="mat-option" *ngFor="let chat of myChats$ | async" [value]="chat.id">
          <div class="chat-preview-container">
            <div class="chat-preview">
              <img class="user-img" [src]="chat.chatPic ? chat.chatPic : 'assets/icons/image-placeholder.png'" />
              <div class="chat-preview-details">
                <p class="chat-title">
                  <span class="chat-name">{{ chat.chatName }}</span>
                  <span class="chat-date">{{chat.lastMessageDate | dateDisplay}}</span>
                </p>
                <p>{{ chat.lastMessage }}</p>
              </div>
            </div>
            <hr>
          </div>
        </mat-list-option>
      </mat-selection-list>
    </div>
    <div class="messages mat-elevation-z5">
      <div class="messages-header" *ngIf="selectedChat$ | async as selectedChat; else noChatSelected">
        <img [src]="
            selectedChat.chatPic
              ? selectedChat.chatPic
              : 'assets/icons/image-placeholder.png'
          " />
        <h2>{{ selectedChat.chatName }}</h2>
      </div>
      <ng-template #noChatSelected>
        <h2>Messages</h2>
      </ng-template>
      <mat-divider></mat-divider>
      <div class="chat-area">
        <ng-container *ngIf="user$ | async as currentUser">
          <ng-container *ngIf="messages$ | async as messages">
            <div class="chat-bubble-container" [ngClass]="{ sender: message.senderId === currentUser.uid }"
              *ngFor="let message of messages">
              <div class="chat-bubble">
                {{ message.text }}
                <span class="chat-time">{{
                  message.sentDate | dateDisplay
                  }}</span>
              </div>
            </div>
          </ng-container>
        </ng-container>
        <div #endOfChat></div>
      </div>
      <div class="input-area">
        <mat-form-field appearance="outline">
          <input matInput placeholder="Enter your message..." [formControl]="messageControl"
            (keydown.enter)="sendMessage()" />
          <button mat-icon-button matSuffix (click)="sendMessage()">
            <mat-icon>send</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>
  </div>
</frame>
